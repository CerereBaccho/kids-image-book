# GitHub Actionsã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
name: Deploy to GitHub Pages

on:
  # mainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã¨ãã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ
  push:
    branches:
      - main
  # GitHub Actionsã®UIã‹ã‚‰æ‰‹å‹•å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  workflow_dispatch:

permissions:
  contents: write

# å®Ÿè¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã‚’æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆã«é™å®šã—ã€å‰ã®ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
concurrency:
  cancel-in-progress: true
  group: ${{ github.workflow }}-${{ github.ref }}

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã—ã¦ã„ã‚‹Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ãã ã•ã„
        uses: actions/setup-node@v4
        with:
          node-version: '20' 

      - name: ğŸ“¦ Install Dependencies
        run: npm install

      - name: ğŸ”¨ Build Vite Project
        # ViteãŒ /pwa-kids-gallery/ ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã™ã‚‹é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        run: npm run build 

      - name: ğŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # GitHubãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’èªè¨¼
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
          publish_dir: ./dist
          # ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒ–ãƒ©ãƒ³ãƒã‚’ gh-pages ã«è¨­å®š
          publish_branch: gh-pages
